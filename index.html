<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ğŸ ì¹´íŠ¸ë¼ì´ë” ë¦¬ê·¸ ë§µ ë°´í”½ ì‹œë®¬ë ˆì´í„° ğŸ</title>
<style>
  body { 
    font-family: 'Malgun Gothic', 'Apple SD Gothic Neo', sans-serif; 
    color: #333; 
    margin: 0; 
    padding: 0;
    text-align: center; 
    line-height: 1.6;
    background-color: #f0f2f5; 
    transition: background-color 0.5s ease; 
  }
  .container { 
    max-width: 960px; 
    margin: 30px auto; 
    background-color: #fff; 
    padding: 30px; 
    border-radius: 15px; 
    box-shadow: 0 8px 25px rgba(0,0,0,0.15); 
    position: relative; 
  }
  /* ì‹œì‘ í™”ë©´ */
  #start-screen {
    display: flex; 
    flex-direction: column; 
    align-items: center; 
    justify-content: center; 
    min-height: 100vh; 
    padding: 50px 20px;
    background-color: #f8f9fa;
    box-shadow: 0 4px 20px rgba(0,0,0,0.1);
    position: fixed; top:0; left:0; width:100%; height:100%; z-index: 1000; 
  }
  #start-screen h1 {
    color: #2c3e50;
    font-size: 2.2em;
    margin-bottom: 30px;
  }
  .team-input-group {
    margin-bottom: 20px;
    text-align: left;
    display: flex; 
    align-items: center;
    width: 80%; 
    max-width: 400px;
  }
  .team-input-group label {
    flex-shrink: 0; 
    font-size: 1.1em;
    color: #555;
    margin-right: 15px;
    min-width: 90px; 
  }
  .team-input-group input[type="text"] {
    flex-grow: 1; 
    padding: 12px;
    border: 1px solid #ccc;
    border-radius: 8px;
    font-size: 1.1em;
  }
  #start-button {
    background-color: #3498db;
    color: white;
    padding: 15px 30px;
    border: none;
    border-radius: 10px;
    font-size: 1.4em;
    cursor: pointer;
    transition: background-color 0.3s ease;
    box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    margin-top: 30px;
  }
  #start-button:hover {
    background-color: #2980b9;
  }

  /* ë™ì „ ë˜ì§€ê¸° í™”ë©´ ìŠ¤íƒ€ì¼ */
  #coin-toss-screen {
    display: none; 
    flex-direction: column;
    align-items: center;
    justify-content: center;
    min-height: 100vh;
    padding: 50px 20px;
    background-color: #f8f9fa;
    position: fixed; top:0; left:0; width:100%; height:100%; z-index: 1000;
  }
  #coin-toss-screen h2 {
    font-size: 2em; margin-bottom: 30px; color: #2c3e50;
    border-bottom: none; 
  }
  #coin {
    width: 150px; height: 150px;
    border-radius: 50%;
    background-color: #ffd700; 
    border: 5px solid #ccab00;
    cursor: pointer;
    display: flex; align-items: center; justify-content: center;
    font-size: 3em; font-weight: bold; color: #fff;
    box-shadow: 0 8px 15px rgba(0,0,0,0.2);
    transition: transform 0.5s ease-out;
  }
  #coin.flipping {
    animation: flip 0.8s ease-out;
  }
  @keyframes flip {
    0% { transform: rotateY(0deg); }
    50% { transform: rotateY(180deg); }
    100% { transform: rotateY(360deg); }
  }
  #toss-result {
    font-size: 1.8em; font-weight: bold; margin-top: 30px;
    color: #34495e;
  }

  /* âœ¨ ìŠ¬ë¡¯ ë¨¸ì‹  ëª¨ë‹¬ ìŠ¤íƒ€ì¼ âœ¨ */
  #roulette-modal {
    display: none; 
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    background: rgba(0, 0, 0, 0.7);
    display: flex; align-items: center; justify-content: center;
    z-index: 100000; 
  }
  .roulette-content {
    background: #fff; padding: 40px; border-radius: 20px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.5);
    max-width: 400px; width: 90%;
    text-align: center; transform: scale(0.9); opacity: 0;
    transition: transform 0.3s ease, opacity 0.3s ease;
  }
  #roulette-modal.show .roulette-content {
    transform: scale(1); opacity: 1;
  }
  .roulette-content h3 {
    font-size: 2.2em; color: #2c3e50; margin-bottom: 30px;
    border-bottom: none;
  }
  /* ìŠ¬ë¡¯ ë¨¸ì‹  ì»¨í…Œì´ë„ˆ (ë‹¨ì¼ ë§µ í¬ê¸°) */
  .slot-container {
      width: 100%;
      height: 55px; /* ìŠ¬ë¡¯ ë†’ì´ - í•˜ë‚˜ì˜ ë§µë§Œ ë³´ì´ê²Œ */
      border: 5px solid #f39c12;
      border-radius: 10px;
      overflow: hidden; 
      margin: 0 auto 30px;
      position: relative;
      background-color: #ecf0f1;
      box-shadow: inset 0 0 15px rgba(0,0,0,0.3); 
  }
  /* ìŠ¬ë¡¯ ì•„ì´í…œ ë¦¬ìŠ¤íŠ¸ */
  .slot-list {
      position: absolute;
      top: 0; left: 0; width: 100%;
      transition: transform 0.08s linear; /* ë” ë¹ ë¥¸ ìŠ¤í¬ë¡¤ ì†ë„ */
  }
  /* ìŠ¬ë¡¯ ê°œë³„ ì•„ì´í…œ */
  .slot-item {
      height: 55px; /* ê° ë§µ ì•„ì´í…œì˜ ë†’ì´ */
      display: flex; align-items: center; justify-content: center;
      font-size: 1.2em; font-weight: bold;
      color: #333;
      border-bottom: 1px solid #ddd;
      box-sizing: border-box; 
      background-color: #fff; 
  }

  .roulette-result-display {
    font-size: 2.5em; font-weight: bold; color: #2ecc71; margin-bottom: 20px;
    text-shadow: 1px 1px 2px rgba(0,0,0,0.2);
  }
  /* âœ¨ í™•ì¸ ë²„íŠ¼ ì‚­ì œ âœ¨ */
  #roulette-ok-button {
      display: none; /* í™•ì¸ ë²„íŠ¼ ìˆ¨ê¹€ (ìë™ ì „í™˜) */
  }

  /* ë°´í”½ í™”ë©´ */
  h1 { 
    color: #2c3e50; margin-bottom: 25px; 
    font-size: 2.5em; font-weight: 800;
  }
  h2 {
    color: #34495e; margin-top: 30px; margin-bottom: 20px;
    font-size: 1.8em; font-weight: 700;
    border-bottom: 2px solid #eee; padding-bottom: 10px;
  }
  .timer-display { 
    font-size: 2.2em; font-weight: bold; color: #e74c3c; 
    margin-bottom: 25px; margin-top: 40px; 
    letter-spacing: 1px; text-align: center;
  }
  .current-turn-info { 
    font-size: 1.7em; font-weight: 700; padding: 15px; border-radius: 10px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.08);
    transition: background-color 0.3s ease, border-color 0.3s ease, color 0.3s ease;
    border: 2px solid #aaa; margin-top: 20px; 
  }

  .search-box { margin-bottom: 30px; transition: opacity 0.5s ease; }
  .search-box input {
    width: 70%; padding: 14px 20px; border: 1px solid #ddd; border-radius: 30px;
    font-size: 1.1em; outline: none; box-shadow: 0 3px 10px rgba(0,0,0,0.08);
    transition: border-color 0.3s, box-shadow 0.3s;
  }
  .search-box input::placeholder { color: #aaa; }
  .search-box input:focus {
    border-color: #3498db; box-shadow: 0 3px 12px rgba(52, 152, 219, 0.2);
  }

  .map-grid-section { transition: opacity 0.5s ease; }
  .map-grid { 
    display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); 
    gap: 18px; margin-top: 30px; justify-content: center;
  }
  .map-item {
    background-color: #ecf0f1; border-radius: 10px; padding: 18px;
    cursor: pointer; transition: all 0.2s ease;
    box-shadow: 0 4px 12px rgba(0,0,0,0.08); 
    font-size: 1.15em; font-weight: bold;
    display: flex; align-items: center; justify-content: center;
    height: 90px; word-break: keep-all; 
  }
  .map-item:hover:not(.picked):not(.banned):not(.disabled) {
    transform: translateY(-8px); background-color: #dbe4e6;
    box-shadow: 0 6px 18px rgba(0,0,0,0.12);
  }
  .map-item.picked { 
    background-color: #2ecc71; color: white; box-shadow: none;
    border: 2px solid #28a745; cursor: default;
  }
  .map-item.banned { 
    background-color: #e74c3c; color: white; cursor: default; 
    text-decoration: line-through; opacity: 0.8; box-shadow: none;
    border: 2px solid #c0392b; 
  }
  .map-item.disabled { 
    opacity: 0.6; cursor: not-allowed; filter: grayscale(10%);
  }
  .result-display { 
    margin-top: 30px; padding-top: 30px; border-top: 1px solid #eee; 
    display: flex; flex-wrap: wrap; justify-content: center; gap: 20px; 
  }
  .result-section { 
    flex: 1; min-width: 300px; padding: 15px;
    border: 1px solid #eee; border-radius: 10px;
    background: #fcfcfc; box-shadow: 0 2px 10px rgba(0,0,0,0.05);
  }
  .result-section h3 {
    font-size: 1.3em; color: #555; margin-bottom: 15px;
    border-bottom: 1px dashed #eee; padding-bottom: 5px;
  }
  .result-item-list { 
    display: flex; flex-wrap: wrap; justify-content: center; 
    gap: 10px; margin-top: 5px; 
  }
  .result-item { 
    background: #e0f2f7; padding: 8px 12px; border-radius: 6px; 
    font-size: 0.95em; color: #34495e; box-shadow: 0 2px 5px rgba(0,0,0,0.05);
    flex-shrink: 0; position: relative;
  }
  .result-item.banned-map { 
    background: #ffcccc; color: #c0392b; text-decoration: line-through;
    border: 1px solid #c0392b;
  }
  /* ë§µ ìˆœì„œ ë²ˆí˜¸ */
  .result-item .order-number {
    font-weight: bold; color: #555; margin-right: 6px; user-select: none;
  }
  /* ë°´ëœ ë§µì—ì„œëŠ” ë²ˆí˜¸ ìˆ¨ê¸°ê¸° */
  #bannedMapsList .result-item .order-number { display: none; }
  .game-status {
    font-size: 1.4em; font-weight: 600; margin-top: 25px; color: #666;
  }
  .game-status.finished { 
    color: #333; font-size: 1.8em;
    text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
  }
  .timeout-message { 
    color: #e74c3c; font-weight: bold; font-size: 1.2em; margin-bottom: 10px;
  }
  /* íŒ€ ì´ë¦„ ë°•ìŠ¤ ì–‘ì˜† ê³ ì •, í™”ë©´ ìƒë‹¨ ë”± ë¶™ê³  ì œëª©ê³¼ ê°„ì„­ ì—†ìŒ */
  .team-display-area {
    position: fixed;
    top: 60px; left: 10px; right: 10px;
    display: flex; justify-content: space-between;
    z-index: 10000; pointer-events: none;
  }
  .team-display-name {
    pointer-events: auto;
    display: flex; align-items: center; gap: 10px;
    border-radius: 10px; padding: 14px 22px;
    font-weight: bold; font-size: 1.6em; 
    box-shadow: 0 4px 8px rgba(0,0,0,0.12);
    color: white; min-width: 150px; justify-content: center; user-select: none;
  }
  .team-display-name.blue { background-color: #007bff; }
  .team-display-name.red { background-color: #e74c3c; }
  .team-display-name.active {
    box-shadow: 0 0 20px 6px rgba(255, 255, 255, 0.85);
    transform: scale(1.07); transition: transform 0.3s ease, box-shadow 0.3s ease;
  }
  .team-display-name .color-dot {
    width: 18px; height: 18px; border-radius: 50%;
    background-color: white; border: 1px solid rgba(0,0,0,0.2);
  }
  /* âœ¨ ëœë¤ ë§µ ì„ íƒ ë²„íŠ¼ ìŠ¤íƒ€ì¼ âœ¨ */
  .map-item.random-pick-button {
      background-color: #9b59b6; /* ë³´ë¼ìƒ‰ */
      color: white;
      border: 2px solid #8e44ad;
  }
  .map-item.random-pick-button:hover:not(.picked):not(.banned):not(.disabled) {
      background-color: #8e44ad;
      transform: translateY(-5px);
  }
</style>
</head>
<body>
  <!-- ì‹œì‘ í™”ë©´ -->
  <div id="start-screen">
    <div style="background:#fff; padding:30px; border-radius:15px; box-shadow:0 8px 25px rgba(0,0,0,0.15); max-width:500px; margin:auto;">
      <h1>ğŸ ì¹´íŠ¸ë¼ì´ë” ë§µ ë°´í”½ ì‹œë®¬ë ˆì´í„° ğŸ</h1>
      <div class="team-input-group">
        <label for="ourTeamNameInput">ìš°ë¦¬ íŒ€ ì´ë¦„:</label>
        <input type="text" id="ourTeamNameInput" placeholder="ì˜ˆ: ë¬´í•œë„ì „" value="Blue Team" />
      </div>
      <div class="team-input-group">
        <label for="opponentTeamNameInput">ìƒëŒ€ íŒ€ ì´ë¦„:</label>
        <input type="text" id="opponentTeamNameInput" placeholder="ì˜ˆ: ì—ì´ìŠ¤íŒ€" value="Red Team" />
      </div>
      <button id="start-button">ë°´í”½ ì‹œì‘!</button>
    </div>
  </div>

  <!-- ë™ì „ ë˜ì§€ê¸° í™”ë©´ -->
  <div id="coin-toss-screen">
    <h2>ì„ ê³µ íŒ€ì„ ì •í•©ë‹ˆë‹¤!</h2>
    <div id="coin">?</div>
    <div id="toss-result">ë™ì „ì„ í´ë¦­í•´ì£¼ì„¸ìš”!</div>
  </div>

  <!-- âœ¨ ìŠ¬ë¡¯ ë¨¸ì‹  ëª¨ë‹¬ âœ¨ -->
  <div id="roulette-modal">
    <div class="roulette-content">
      <h3 id="rouletteTitle"></h3> <!-- âœ¨ ìŠ¬ë¡¯ ë¨¸ì‹  ì œëª© (ëœë¤í”½/ì‹œê°„ì´ˆê³¼ì— ë”°ë¼ ë‹¬ë¼ì§) -->
      <div class="slot-container">
          <div class="slot-list" id="slotList"></div>
      </div>
      <div class="roulette-result-display" id="rouletteResultDisplay"></div>
      <!-- âœ¨ í™•ì¸ ë²„íŠ¼ ì‚­ì œ (ìë™ ì „í™˜) âœ¨ -->
    </div>
  </div>


  <!-- ë°´í”½ í™”ë©´ -->
  <div id="banpick-screen" style="display:none;">
    <div class="container">
      <!-- íŒ€ ì´ë¦„ ë°•ìŠ¤ ì–‘ì˜† ìƒë‹¨ì— ê³ ì • -->
      <div class="team-display-area">
        <div id="ourTeamDisplay" class="team-display-name blue">
          <div class="color-dot"></div> <span id="ourTeamNameDisplay"></span>
        </div>
        <div id="opponentTeamDisplay" class="team-display-name red">
          <span id="opponentTeamNameDisplay"></span> <div class="color-dot"></div>
        </div>
      </div>

      <h1>ğŸ ì¹´íŠ¸ë¼ì´ë” ë¦¬ê·¸ ë§µ ë°´í”½ ì‹œë®¬ë ˆì´í„° ğŸ</h1>
      <div class="timer-display" id="timer"></div>
      <div class="current-turn-info" id="currentTurnInfo"></div>

      <!-- ì„ íƒ / ë°´ ë§µ ìµœì¢… ê²°ê³¼ -->
      <div class="result-display">
        <div class="result-section">
          <h3>âœ” ì„ íƒëœ ë§µ</h3>
          <div id="pickedMapsList" class="result-item-list"></div>
        </div>
        <div class="result-section">
          <h3>âœ– ë°´ëœ ë§µ</h3>
          <div id="bannedMapsList" class="result-item-list"></div>
        </div>
      </div>
      <p class="game-status" id="gameStatus"></p>

      <div id="mapSelectionArea" class="map-grid-section">
        <div class="search-box">
          <input type="text" id="mapSearchInput" placeholder="ë§µ ì´ë¦„ìœ¼ë¡œ ê²€ìƒ‰..." onkeyup="updateMapListUI()" />
        </div>

        <h2>ë§µ ë¦¬ìŠ¤íŠ¸</h2> 
        <div class="map-grid" id="mapList"></div>
      </div>
    </div>
  </div>

<script>
  const allMaps = [
    "ë¹Œë¦¬ì§€ ë‚¨ì‚°", "ë¹„ì¹˜ í•´ë³€ ë“œë¼ì´ë¸Œ",
    "WKC ì‹±ê°€í´ ì„œí‚·", "1920 ì•„ìŠ¬ì•„ìŠ¬ ë¹„í–‰ì¥", "ì°¨ì´ë‚˜ ë¼ì‚¬",
    "ì°¨ì´ë‚˜ ìš©ì˜ ìš´í•˜", "ì¥ë¼ê¸° ê³µë£¡ ë¬´ë¤", "ì°¨ì´ë‚˜ ë°”ë‹¤ì˜ ìš´ìœ¨",
    "ì‹ í™” ì°¨ì›ì˜ ê´€ë¬¸", "ë” ì›”ë“œ", "ì–´ë¹„ìŠ¤ ìš´ëª…ì˜ ê°ˆë¦¼ê¸¸",
    "WKC ì½”ë¦¬ì•„ ì„œí‚·", "ì›”ë“œ ë‘ë°”ì´ ë‹¤ìš´íƒ€ìš´", "ë„ê²€ ì•¼ì™¸ ìˆ˜ë ¨ê´€",
    "ì›”ë“œ ë¦¬ì˜¤ ë‹¤ìš´í", "ì¥ë¼ê¸° ê³µë£¡ ê²°íˆ¬ì¥", "ë¬¸íì‹œí‹° í­ìš° ì†ì˜ ì§ˆì£¼",
    "ë©”ì¹´ë‹‰ ìŠí˜€ì§„ ë„ì‹œì˜ ì¤‘ì‹¬ë¶€", "ë¹Œë¦¬ì§€ ìš´ëª…ì˜ ë‹¤ë¦¬", "ë„ê²€ ìš©ì˜ ê¸¸", "ë„¤ëª¨ ì¥ë‚œê° ì„ ë¬¼ ê³µì¥",
    "ë¸Œë¡œë”” ë¹„ë°€ì˜ ì—°êµ¬ì†Œ", "ë…¸ë¥´í…Œìœ  ì „íˆ¬ ë¹„í–‰ì¥", "(R)ë¹Œë¦¬ì§€ ê³ ê°€ì˜ ì§ˆì£¼", "ë¹Œë¦¬ì§€ ìµìŠ¤íŠ¸ë¦¼ ê²½ê¸°ì¥",
    "ì›”ë“œ íŒŒë¦¬ ì—í íƒ‘ ë‹¤ì´ë¸Œ", "ì›”ë“œ ë‰´ìš• ëŒ€ì§ˆì£¼", "ì°¨ì´ë‚˜ ì²­ëª…í•œ í•˜ëŠ˜ì˜ ì„œí˜¸", "ì‹ í™” ì‹ ë“¤ì˜ ì„¸ê³„",
    "íŒ©í† ë¦¬ ë¶€ë¹„íŠ¸ë© ê³µì¥ íƒí—˜", "(R)í•´ì  ë¡œë¹„ ì ˆë²½ì˜ ê²°íˆ¬", "ë™í™” ë§ˆë…€ì˜ ì„±", "ë¬¸íì‹œí‹° ì§€í”¼ì˜ ì‹œì²­ê´‘ì¥",
    "ê´‘ì‚° ì•„ìŠ¬ì•„ìŠ¬ ê¶¤ë„ ì „ì°¨", "ì‚¬ë§‰ ë†€ë¼ìš´ ê³µë£¡ ìœ ì ì§€", "ë„¤ëª¨ ê°•ì² ë°”ìœ„ ìš©ê´‘ë¡œ", "ë™í™” ì ìëŠ” ìˆ²ì†ì˜ ê±°ì¸" ,
    "WKC ìƒí•´ ì„œí‚·", "ë…¸ë¥´í…Œìœ  ìŠ¤ì¹´ì´ì›¨ì´",
    "ì¹´ë©œë¡¯ íŒ¬ë“œë˜ê±´ ìºìŠ¬", "ì‹ í™” ì˜¤ë”˜ì˜ ê¶ì „", "ì˜¬ë¦¼í¬ìŠ¤ ì œìš°ìŠ¤ì‹œí‹°",
    "ì›”ë“œ ì´íƒˆë¦¬ì•„ ì—¬í–‰", "ì¹´ë©œë¡¯ ì™¸ê³½ ìˆœì°°ë¡œ", "ì–´ë¹„ìŠ¤ ë°”ë‹¤ ì†Œìš©ëŒì´",
    "ì°¨ì´ë‚˜ ì„œì•ˆ ë³‘ë§ˆìš©", "ë¹Œë¦¬ì§€ ë§Œë¦¬ì¥ì„±", "í•´ì  ë¡œë¹„ ì ˆë²½ì˜ ê²°íˆ¬",
    "ë‹˜í”„ ë°”ë‹¤ì‹ ì „ì˜ ë¹„ë°€", "í¬ë ˆìŠ¤íŠ¸ ì§€ê·¸ì¬ê·¸", "WKC ë¸Œë¼ì§ˆ ì„œí‚·",
    "ì‚¬ë§‰ ë¹™ê¸€ë¹™ê¸€ ê³µì‚¬ì¥", "ëŒ€ì €íƒ ì€ë°€í•œ ì§€í•˜ì‹¤", "ì°¨ì´ë‚˜ í™©ì‚°",
    "í•´ì  ìˆ¨ê²¨ì§„ ë³´ë¬¼", "ë¹Œë¦¬ì§€ ë¶í í„°ë„", "ì•„ì´ìŠ¤ ê°ˆë¼ì§„ ë¹™ì‚°", "í™©ê¸ˆë¬¸ëª… ë¹„ë°€ì¥ì¹˜ì˜ ìœ„í˜‘",
    "ë„¤ëª¨ ì‚°íƒ€ì˜ ë¹„ë°€ ê³µê°„", "í™©ê¸ˆë¬¸ëª… ì˜¤ë¥´ì—íŠ¸ í™©ê¸ˆ ì¢Œí‘œ", "ì°¨ì´ë‚˜ ê³¨ëª©ê¸¸ ëŒ€ì§ˆì£¼", "í•´ì  ê°€íŒŒë¥¸ ê°ì‹œíƒ‘",
    "ë„ê²€ êµ¬ë¦„ì˜ í˜‘ê³¡", "íŒ©í† ë¦¬ ë‘ ê°œì˜ ê³µì¥", "í•´ì  ìƒì–´ì„¬ì˜ ë¹„ë°€", "í¬ë ˆìŠ¤íŠ¸ ì˜¤ì‹¹í•œ ê³µì¤‘ë‹¤ë¦¬",
    "í¬ë ˆìŠ¤íŠ¸ ëŒ€ê´€ë ¹", "ê´‘ì‚° 3ê°œì˜ ì§€ë¦„ê¸¸", "ì¥ë¼ê¸° ê³µë£¡ì„¬ ëŒ€ëª¨í—˜", "WKC íˆ¬ì–´ë§ ë ë¦¬",
    "ì•„ì´ìŠ¤ ì•„ì°”í•œ í—¬ê¸° ì í”„", "ì–´ë¹„ìŠ¤ ìˆ¨ê²¨ì§„ ë°”ë‹·ê¸¸", "ì‚¬ë§‰ ì˜¤ë˜ëœ ì†¡ìˆ˜ê´€", "ê³µë™ë¬˜ì§€ í•´ê³¨ì„± ëŒ€íƒí—˜" ,
    "ì˜¬ë¦¼í¬ìŠ¤ í•˜ëŠ˜ì˜ ì‹ ì „", "ë™í™”ë‚˜ë¼ ì´ìƒí•œ ë‚˜ë¼ì˜ ë¬¸", "ë…¸ë¥´í…Œìœ  ìµìŠ¤í”„ë ˆìŠ¤", "ê´‘ì‚° ê¼¬ë¶ˆê¼¬ë¶ˆ ë‹¤ìš´í",
    "íŒ©í† ë¦¬ ë¯¸ì™„ì„± 5êµ¬ì—­", "í¬ë ˆìŠ¤íŠ¸ ì•„ì°”í•œ ë‹¤ìš´í", "ê³µë™ë¬˜ì§€ ë§ˆì™•ì˜ ì´ˆëŒ€", "ì•„ì´ìŠ¤ ì„¤ì‚° ë‹¤ìš´í",
    "(R)í¬ë ˆìŠ¤íŠ¸ ì§€ê·¸ì¬ê·¸", "ë¬¸íì‹œí‹° ìˆ¨ê²¨ì§„ ì§€í•˜í„°ë„", "ê´‘ì‚° ìœ„í—˜í•œ ì œë ¨ì†Œ", "ì°¨ì´ë‚˜ ìš©ì˜ ì„±ì§€",
    "í•´ì  ëŒ€í•´ì  ë¡œë‘ë§ˆë‹ˆ", "ì•„ì´ìŠ¤ ë¶€ì„œì§„ ë¹™ì‚°" 
  ];
  
  let pickedMaps = []; 
  let currentBannedMaps = []; 

  // ê³ ì • ë§µ ì„¤ì •
  const FIXED_MAP = "ë¹Œë¦¬ì§€ ê³ ê°€ì˜ ì§ˆì£¼"; // ì—¬ê¸°ì— ì›í•˜ëŠ” ê³ ì •ë§µ ì´ë¦„ ì…ë ¥
  const RANDOM_MAP_OPTION = "ëœë¤ ë§µ ì„ íƒ"; // ëœë¤ ë§µ ì˜µì…˜

  let teamAMappedInfo = { name: "Blue Team", color: "#007bff" }; 
  let teamBMappedInfo = { name: "Red Team", color: "#e74c3c" }; 

  let ourTeamName = "Blue Team"; 
  let opponentTeamName = "Red Team"; 
  const ourTeamColor = "#007bff"; 
  const opponentTeamColor = "#e74c3c";

  let currentTurnInternal = 'íŒ€ A';
  let currentPhase = 'ë°´'; // ì²« ì‹œì‘ì´ ë°´ì´ë„¤!
  // totalPicksNeededë„ ë°”ë€ í”½ ê°¯ìˆ˜ì— ë§ì¶°ì¤˜ì•¼ í•¨
  const totalPicksNeeded = 13; // ìƒˆ ë°´í”½ ìˆœì„œì— í”½ì´ ì´ 9ë²ˆ ìˆì–´

  const phasePlan = [
    { type: 'ë°´', team: 'íŒ€ A' },
    { type: 'ë°´', team: 'íŒ€ B' },
    { type: 'í”½', team: 'íŒ€ A' },
    { type: 'í”½', team: 'íŒ€ B' },
    { type: 'í”½', team: 'íŒ€ A' },
    { type: 'í”½', team: 'íŒ€ B' },
    { type: 'ë°´', team: 'íŒ€ A' },
    { type: 'ë°´', team: 'íŒ€ B' },
    { type: 'í”½', team: 'íŒ€ A' },
    { type: 'í”½', team: 'íŒ€ B' },
    { type: 'í”½', team: 'íŒ€ A' },
    { type: 'í”½', team: 'íŒ€ B' },
    { type: 'í”½', team: 'íŒ€ A' },
    { type: 'í”½', team: 'íŒ€ B' },
    { type: 'ë°´', team: 'íŒ€ A' },
    { type: 'ë°´', team: 'íŒ€ B' },
    { type: 'í”½', team: 'íŒ€ A' },
    { type: 'í”½', team: 'íŒ€ B' },
    { type: 'í”½', team: 'íŒ€ A' }
  ];
  let currentPhaseIndex = 0;

  const pickTimeLimit = 20;
  let timerInterval;
  let timeLeft = pickTimeLimit;

  // HTML ìš”ì†Œë“¤ ê°€ì ¸ì˜¤ê¸°
  const startScreen = document.getElementById('start-screen'); 
  const coinTossScreen = document.getElementById('coin-toss-screen'); 
  const banpickScreen = document.getElementById('banpick-screen'); 

  const ourTeamNameInput = document.getElementById('ourTeamNameInput'); 
  const opponentTeamNameInput = document.getElementById('opponentTeamNameInput'); 
  const startButton = document.getElementById('start-button'); 

  const coinElement = document.getElementById('coin'); 
  const tossResultElement = document.getElementById('toss-result'); 

  // ìŠ¬ë¡¯ ë¨¸ì‹  ê´€ë ¨ ìš”ì†Œë“¤ (ë£°ë › ëª¨ë‹¬ -> ìŠ¬ë¡¯ ë¨¸ì‹ )
  const rouletteModal = document.getElementById('roulette-modal'); 
  const slotList = document.getElementById('slotList'); 
  const rouletteResultDisplay = document.getElementById('rouletteResultDisplay'); 
  const rouletteTitle = document.getElementById('rouletteTitle'); // ìŠ¬ë¡¯ ë¨¸ì‹  ì œëª©

  const mapSelectionArea = document.getElementById('mapSelectionArea'); 

  const mapListDiv = document.getElementById('mapList');
  const pickedMapsListDiv = document.getElementById('pickedMapsList');
  const bannedMapsListDiv = document.getElementById('bannedMapsList'); 
  const timerDisplay = document.getElementById('timer');
  const currentTurnInfoDisplay = document.getElementById('currentTurnInfo'); 
  const gameStatusDisplay = document.getElementById('gameStatus');
  const mapSearchInput = document.getElementById('mapSearchInput');

  const ourTeamInfoBox = document.getElementById('ourTeamDisplay');
  const opponentTeamInfoBox = document.getElementById('opponentTeamDisplay');
  const ourTeamNameDisplay = document.getElementById('ourTeamNameDisplay');
  const opponentTeamNameDisplay = document.getElementById('opponentTeamNameDisplay');

  // ë‚´ë¶€ íŒ€ ëª…(íŒ€ A/B)ì— ë§¤í•‘ëœ ì‹¤ì œ íŒ€ ì •ë³´ ë°˜í™˜
  function getTeamInfo(internalTeam) {
    if (internalTeam === 'íŒ€ A') {
      return teamAMappedInfo;
    } else {
      return teamBMappedInfo;
    }
  }

  // ìƒ‰ìƒì„ ì—°í•˜ê²Œ ë§Œë“œëŠ” í•¨ìˆ˜ (Hex to RGBA í›„ íˆ¬ëª…ë„ ì ìš©)
  function hexToRgba(hex, alpha) {
    let r = parseInt(hex.slice(1, 3), 16),
        g = parseInt(hex.slice(3, 5), 16),
        b = parseInt(hex.slice(5, 7), 16);
    return `rgba(${r}, ${g}, ${b}, ${alpha})`;
  }

  function updateMapListUI() { 
    const searchTerm = mapSearchInput.value.toLowerCase().trim(); 
    mapListDiv.innerHTML = ''; 

    const searchTermNoSpace = searchTerm.replace(/\s/g, '');
    
    // "ëœë¤ ë§µ ì„ íƒ" ì˜µì…˜ì€ í•­ìƒ ëª©ë¡ì— í¬í•¨ (í•„í„°ë§ ì œì™¸)
    let availableToSelectMaps = allMaps.filter(map => 
      !pickedMaps.includes(map) && !currentBannedMaps.includes(map) && map !== FIXED_MAP
    );
    
    let filteredAndAvailableMaps = availableToSelectMaps.filter(map => {
        const mapLower = map.toLowerCase();
        const mapNoSpace = mapLower.replace(/\s/g, '');

        return mapLower.includes(searchTerm) || 
               mapNoSpace.includes(searchTermNoSpace);
    });

    // ê²€ìƒ‰ëœ ë§µì´ 1ê°œë¼ë„ ìˆê³ , ê³ ì •ë§µì´ ì•„ë‹ˆë©°, ì´ë¯¸ í”½/ë°´ ë˜ì§€ ì•Šì€ ê²½ìš°ì—ë§Œ 'ëœë¤ ë§µ ì„ íƒ'ì„ ëª©ë¡ì— ì¶”ê°€
    // (ê²€ìƒ‰ì–´ì™€ ì¼ì¹˜í•˜ëŠ” ì¼ë°˜ ë§µì´ ìˆì„ ê²½ìš° ë§¨ ì•ì—, ì•„ë‹ˆë©´ ë§ˆì§€ë§‰ì— ì¶”ê°€)
    if (availableToSelectMaps.length > 0) { // ì„ íƒ ê°€ëŠ¥í•œ ë§µì´ ìˆì–´ì•¼ ëœë¤ ì˜µì…˜ë„ ìœ íš¨
        if (filteredAndAvailableMaps.includes(RANDOM_MAP_OPTION) === false && 
            (searchTerm.includes(RANDOM_MAP_OPTION.toLowerCase().replace(/\s/g, '')) || searchTerm === "")) {
            if (filteredAndAvailableMaps.length === 0 && searchTerm !== "") { 
                filteredAndAvailableMaps = [RANDOM_MAP_OPTION]; 
            } else if (searchTerm === "") { 
                filteredAndAvailableMaps = [RANDOM_MAP_OPTION, ...filteredAndAvailableMaps];
            } else { 
                 if (RANDOM_MAP_OPTION.toLowerCase().replace(/\s/g, '').includes(searchTermNoSpace)) {
                    filteredAndAvailableMaps = [RANDOM_MAP_OPTION, ...filteredAndAvailableMaps.filter(map => map !== RANDOM_MAP_OPTION)];
                 }
            }
        }
    }

    filteredAndAvailableMaps.forEach(map => {
      const mapItem = document.createElement('div');
      mapItem.classList.add('map-item');
      mapItem.textContent = map;
      
      if (map === RANDOM_MAP_OPTION) {
          mapItem.classList.add('random-pick-button'); // âœ¨ ë²„íŠ¼ ìŠ¤íƒ€ì¼ ì¶”ê°€
          mapItem.onclick = () => {
              const mapsForRandomPick = allMaps.filter(m => 
                !pickedMaps.includes(m) && !currentBannedMaps.includes(m) && m !== FIXED_MAP
              );
              if (mapsForRandomPick.length > 0) {
                  const randomChosenMap = mapsForRandomPick[Math.floor(Math.random() * mapsForRandomPick.length)];
                  // âœ¨ ìŠ¬ë¡¯ ë¨¸ì‹  ì œëª© ë³€ê²½
                  triggerSlotMachineAnimation(randomChosenMap, mapsForRandomPick, 'user_random_pick'); 
              } else {
                  currentTurnInfoDisplay.innerHTML = `<span class="timeout-message">[ì„ íƒ ê°€ëŠ¥í•œ ë§µ ì—†ìŒ!]</span><br> ${currentTurnInfoDisplay.innerHTML}`;
              }
          };
      } else {
          mapItem.onclick = () => selectMap(map); 
      }
      mapListDiv.appendChild(mapItem);
    });
  }

  function updateOverallUI() { 
    const currentTurnTeamInfo = getTeamInfo(currentTurnInternal);

    document.body.style.backgroundColor = hexToRgba(currentTurnTeamInfo.color, 0.1);

    currentTurnInfoDisplay.style.backgroundColor = hexToRgba(currentTurnTeamInfo.color, 0.1);
    currentTurnInfoDisplay.style.borderColor = currentTurnTeamInfo.color;
    currentTurnInfoDisplay.style.color = currentTurnTeamInfo.color;

    ourTeamInfoBox.classList.remove('active');
    opponentTeamInfoBox.classList.remove('active');
    if (currentTurnInternal === teamAMappedInfo.internalName) { 
        if (ourTeamName === teamAMappedInfo.name) { 
            ourTeamInfoBox.classList.add('active');
        } else { 
            opponentTeamInfoBox.classList.add('active');
        }
    } else { 
        if (ourTeamName === teamBMappedInfo.name) { 
            ourTeamInfoBox.classList.add('active');
        } else { 
            opponentTeamInfoBox.classList.add('active');
        }
    }

    ourTeamNameDisplay.textContent = ourTeamName;
    opponentTeamNameDisplay.textContent = opponentTeamName;

    pickedMapsListDiv.innerHTML = pickedMaps.map((map, idx) => {
      if (map === FIXED_MAP) {
        return `<div class="result-item"><span class="order-number">ê³ ì •ë§µ</span> ${map}</div>`;
      } else {
        return `<div class="result-item"><span class="order-number">${idx+1}.</span> ${map}</div>`;
      }
    }).join('');

    bannedMapsListDiv.innerHTML = currentBannedMaps.map(map => 
      `<div class="result-item banned-map">${map}</div>`).join('');

    if (pickedMaps.length === totalPicksNeeded) {
      gameStatusDisplay.textContent = 'ë§µ ë°´í”½ ì™„ë£Œ! ê²Œì„ì„ ì‹œì‘í•˜ì„¸ìš”!'; 
      gameStatusDisplay.classList.add('finished'); 
      currentTurnInfoDisplay.innerHTML = `ë°´í”½ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!`; 
      timerDisplay.textContent = 'ê²Œì„ ì¤€ë¹„ ì™„ë£Œ!';
      clearInterval(timerInterval); 
      mapSearchInput.disabled = true; 
      document.body.style.backgroundColor = '#f0f2f5';

      mapSelectionArea.style.opacity = '0'; 
      setTimeout(() => { mapSelectionArea.style.display = 'none'; }, 500); 
    } else {
      gameStatusDisplay.classList.remove('finished');
      gameStatusDisplay.textContent = `í˜„ì¬ ${pickedMaps.length} / ${totalPicksNeeded} ë§µ ì„ íƒë¨`;

      const phase = phasePlan[currentPhaseIndex];
      let actionText = '';
      if (phase.type === 'í”½') {
        actionText = "ë§µì„ <span style='font-size:1.1em; color: inherit;'>ì„ íƒí•˜ì„¸ìš”!</span>"; 
      } else {
        actionText = "ë§µì„ <span style='font-size:1.1em; color: inherit;'>ë°´í•˜ì„¸ìš”!</span>"; 
      }
      currentTurnInfoDisplay.innerHTML = `[${currentTurnTeamInfo.name}] ${phase.type} í˜ì´ì¦ˆ: ${actionText}`; 
      mapSearchInput.disabled = false; 

      mapSelectionArea.style.display = 'block'; 
      setTimeout(() => { mapSelectionArea.style.opacity = '1'; }, 0); 
    }
    updateMapListUI(); 
  }

  function selectMap(mapName) {
    if (mapName === RANDOM_MAP_OPTION) return; 

    if (pickedMaps.length === totalPicksNeeded) return; 

    const currentAction = phasePlan[currentPhaseIndex];

    if (currentAction.type === 'í”½') {
      pickedMaps.push(mapName);
      console.log(`${getTeamInfo(currentTurnInternal).name}ì´(ê°€) ${mapName}ì„(ë¥¼) í”½í–ˆìŠµë‹ˆë‹¤. (ì´ ${pickedMaps.length}ê°œ)`);
    } else { 
      currentBannedMaps.push(mapName);
      console.log(`${getTeamInfo(currentTurnInternal).name}ì´(ê°€) ${mapName}ì„(ë¥¼) ë°´í–ˆìŠµë‹ˆë‹¤. (ì´ ${currentBannedMaps.length}ê°œ ë°´ë¨)`);
    }

    clearInterval(timerInterval); 
    mapSearchInput.value = ''; 
    nextAction(); 
  }

  function startTimer() {
    timeLeft = pickTimeLimit; 
    timerDisplay.textContent = `ë‚¨ì€ ì‹œê°„: ${timeLeft}ì´ˆ`;
    clearInterval(timerInterval); 

    timerInterval = setInterval(() => {
      timeLeft--;
      timerDisplay.textContent = `ë‚¨ì€ ì‹œê°„: ${timeLeft}ì´ˆ`;
      if (timeLeft <= 0) {
        clearInterval(timerInterval);
        
        const availableMapsToSelect = allMaps.filter(map => 
          !pickedMaps.includes(map) && !currentBannedMaps.includes(map) && map !== FIXED_MAP
        );
        let randomMap = '';
        if (availableMapsToSelect.length > 0) {
          randomMap = availableMapsToSelect[Math.floor(Math.random() * availableMapsToSelect.length)];
        } else {
          randomMap = 'ì„ íƒ ê°€ëŠ¥í•œ ë§µ ì—†ìŒ'; // ë¹„ìƒ ìƒí™©: ë§µì´ ì—†ì–´ì„œ ëœë¤ ì„ íƒ ë¶ˆê°€
        }

        // âœ¨ ìŠ¬ë¡¯ ë¨¸ì‹  ì• ë‹ˆë©”ì´ì…˜ ì‹œì‘ (íƒ€ì„ì˜¤ë²„ ë©˜íŠ¸)
        triggerSlotMachineAnimation(randomMap, availableMapsToSelect, 'timeout');
      }
    }, 1000);
  }

  // âœ¨ ìŠ¬ë¡¯ ë¨¸ì‹  ì• ë‹ˆë©”ì´ì…˜ í•¨ìˆ˜
  function triggerSlotMachineAnimation(selectedMap, mapOptions, triggerSource) {
    rouletteModal.style.display = 'flex';
    setTimeout(() => rouletteModal.classList.add('show'), 10); 

    // âœ¨ ë©˜íŠ¸ ë³€ê²½
    if (triggerSource === 'timeout') {
        rouletteTitle.textContent = 'ì‹œê°„ ì´ˆê³¼! ëœë¤ ë§µ ì„ íƒ!';
    } else { // user_random_pick
        rouletteTitle.textContent = 'ëœë¤ ë§µ ì„ íƒ ì§„í–‰!';
    }

    slotList.innerHTML = ''; 
    rouletteResultDisplay.textContent = ''; 
    
    // mapOptionsê°€ ë¹„ì–´ìˆì„ ê²½ìš° (ë” ì´ìƒ ë½‘ì„ ë§µì´ ì—†ì„ ê²½ìš°)
    if (mapOptions.length === 0) {
        rouletteResultDisplay.textContent = 'ë” ì´ìƒ ì„ íƒ ê°€ëŠ¥í•œ ë§µì´ ì—†ìŠµë‹ˆë‹¤!';
        // ë‹¤ìŒ í˜ì´ì¦ˆë¡œ ìë™ ì „í™˜ (ë©˜íŠ¸ ë…¸ì¶œ ì‹œê°„ 1ì´ˆ, ì „í™˜ 2ì´ˆ = ì´ 3ì´ˆ)
        setTimeout(() => {
            rouletteModal.classList.remove('show');
            setTimeout(() => rouletteModal.style.display = 'none', 300); 
            // ë§µ ì—†ìŒ ë©”ì‹œì§€ë¥¼ í˜„ì¬ í„´ ì •ë³´ì— í‘œì‹œ
            updateTurnInfoMessageAfterRandom(triggerSource, true); // no_maps_available í”Œë˜ê·¸ ì¶”ê°€
            nextAction();
        }, 3000);
        return;
    }

    const slotItemHeight = 55; // CSSì˜ .slot-item heightì™€ ì¼ì¹˜
    const totalSpinCycles = 20; // ìµœì†Œ 20ë°”í€´ íšŒì „ (ë” ê¸¸ê²Œ ëŠê»´ì§€ë„ë¡)
    
    // ìµœì¢… ëª©í‘œ ì¸ë±ìŠ¤: ë§ˆì§€ë§‰ì— ë©ˆì¶œ ë§µì˜ ì¸ë±ìŠ¤
    const selectedMapIndexInOptions = mapOptions.indexOf(selectedMap);
    const targetIndexInList = (mapOptions.length * totalSpinCycles) + selectedMapIndexInOptions;

    // ìŠ¬ë¡¯ ë¦¬ìŠ¤íŠ¸ ì±„ìš°ê¸° (ëê¹Œì§€ ìŠ¤í¬ë¡¤ë  ìˆ˜ ìˆë„ë¡ ì¶©ë¶„í•œ ì•„ì´í…œ ì¶”ê°€)
    for (let i = 0; i < targetIndexInList + 5; i++) { // ì—¬ìœ ë¶„ 5ê°œ ì¶”ê°€
        const mapToDisplay = mapOptions[i % mapOptions.length];
        const slotItem = document.createElement('div');
        slotItem.classList.add('slot-item');
        slotItem.textContent = mapToDisplay;
        slotList.appendChild(slotItem);
    }
    
    // ì´ˆê¸°í™” ì‹œ íŠ¸ëœì§€ì…˜ ì œê±°
    slotList.style.transition = 'none'; 
    slotList.style.transform = 'translateY(0)'; 
    
    void slotList.offsetHeight; 

    // ë¹ ë¥´ê²Œ íšŒì „ (ì²« 0.5ì´ˆ)
    const initialSpinDuration = 0.5; 
    slotList.style.transition = `transform ${initialSpinDuration}s linear`;
    slotList.style.transform = `translateY(${-targetIndexInList * slotItemHeight - slotItemHeight * 2}px)`; 

    setTimeout(() => {
        // ìµœì¢… ìœ„ì¹˜ë¡œ íŠ•ê¸°ë“¯ì´ ë©ˆì¶¤ (ë‚˜ë¨¸ì§€ 1.5ì´ˆ, íƒ„ì„± í¬í•¨)
        const finalStopDuration = 1.5; 
        const bounceEasing = 'cubic-bezier(0.175, 0.885, 0.32, 1.275)'; 
        slotList.style.transition = `transform ${finalStopDuration}s ${bounceEasing}`;
        slotList.style.transform = `translateY(${-targetIndexInList * slotItemHeight + ((slotList.parentElement.offsetHeight - slotItemHeight) / 2)}px)`;
        
        slotList.ontransitionend = () => {
            rouletteResultDisplay.textContent = `ì„ íƒëœ ë§µ: ${selectedMap}`; // ê²°ê³¼ ë§µ í‘œì‹œ
            slotList.ontransitionend = null; 

            // âœ¨ 1ì´ˆ ë…¸ì¶œ í›„, 2ì´ˆ ë’¤ ìë™ ì „í™˜ (ì´ 3ì´ˆ)
            setTimeout(() => {
                rouletteModal.classList.remove('show');
                setTimeout(() => rouletteModal.style.display = 'none', 300); 
                
                const currentAction = phasePlan[currentPhaseIndex];
                if (selectedMap !== 'ì„ íƒ ê°€ëŠ¥í•œ ë§µ ì—†ìŒ') { 
                    if (currentAction.type === 'í”½') {
                        pickedMaps.push(selectedMap);
                        console.log(`${getTeamInfo(currentTurnInternal).name} ì‹œê°„ ì´ˆê³¼ë¡œ ${selectedMap} ëœë¤ í”½ë¨.`);
                    } else {
                        currentBannedMaps.push(selectedMap);
                        console.log(`${getTeamInfo(currentTurnInternal).name} ì‹œê°„ ì´ˆê³¼ë¡œ ${selectedMap} ëœë¤ ë°´ë¨.`);
                    }
                }
                updateTurnInfoMessageAfterRandom(triggerSource); // ë©”ì‹œì§€ ì—…ë°ì´íŠ¸
                nextAction(); // ë‹¤ìŒ í˜ì´ì¦ˆ ì§„í–‰
            }, 1000); // ë§µì´ ë„ì°©í•˜ê³  1ì´ˆ ë’¤ì— ë‹¤ìŒ setTimeout ì‹œì‘
        };
    }, initialSpinDuration * 1000); // 0.5ì´ˆ ë’¤ì— ë‹¤ìŒ ìŠ¤í… ì‹œì‘
  }
  
  // ëœë¤í”½ í›„ í„´ ì •ë³´ ë©”ì‹œì§€ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
  function updateTurnInfoMessageAfterRandom(triggerSource, noMapsAvailable = false) {
      const currentTurnTeamInfo = getTeamInfo(currentTurnInternal);
      const phase = phasePlan[currentPhaseIndex];
      let baseActionText = '';
      if (phase.type === 'í”½') {
        baseActionText = "ë§µì„ <span style='font-size:1.1em; color: inherit;'>ì„ íƒí•˜ì„¸ìš”!</span>"; 
      } else {
        baseActionText = "ë§µì„ <span style='font-size:1.1em; color: inherit;'>ë°´í•˜ì„¸ìš”!</span>"; 
      }

      if (noMapsAvailable) { // ë§µì´ ì—†ì„ ê²½ìš°
          currentTurnInfoDisplay.innerHTML = `<span class="timeout-message">[ë” ì´ìƒ ë§µ ì—†ìŒ!]</span><br> [${currentTurnTeamInfo.name}] ${phase.type} í˜ì´ì¦ˆ: ${baseActionText}`;
      } else if (triggerSource === 'timeout') {
          currentTurnInfoDisplay.innerHTML = `<span class="timeout-message">[ì‹œê°„ ì´ˆê³¼!]</span><br> [${currentTurnTeamInfo.name}] ${phase.type} í˜ì´ì¦ˆ: ${baseActionText}`; 
      } else { // user_random_pick
          currentTurnInfoDisplay.innerHTML = `<span class="timeout-message">[ëœë¤ ë§µ ì„ íƒë¨!]</span><br> [${currentTurnTeamInfo.name}] ${phase.type} í˜ì´ì¦ˆ: ${baseActionText}`;
      }
  }

  function nextAction() {
    if (pickedMaps.length === totalPicksNeeded) {
      updateOverallUI(); 
      return;
    }

    currentPhaseIndex++; 

    if (currentPhaseIndex >= phasePlan.length) {
      console.warn("ëª¨ë“  ë°´í”½ í˜ì´ì¦ˆê°€ ì™„ë£Œë˜ì—ˆìœ¼ë‚˜ ë§µì´ 7ê°œ ë¯¸ë§Œìœ¼ë¡œ ì„ íƒë˜ì—ˆìŠµë‹ˆë‹¤.");
      updateOverallUI(); 
      return;
    }
    
    const nextActionData = phasePlan[currentPhaseIndex];
    currentTurnInternal = nextActionData.team; 
    currentPhase = nextActionData.type; 

    updateOverallUI(); 
    startTimer(); 
  }

  // ë™ì „ ë˜ì§€ê¸° ë¡œì§
  function handleCoinToss() {
    coinElement.classList.add('flipping');
    tossResultElement.textContent = "ë™ì „ ë˜ì§€ëŠ” ì¤‘...";

    setTimeout(() => {
      coinElement.classList.remove('flipping');
      const isHeads = Math.random() < 0.5; 
      let tossOutcomeText = "";

      if (isHeads) { 
        teamAMappedInfo = { name: ourTeamName, color: ourTeamColor, internalName: 'íŒ€ A' };
        teamBMappedInfo = { name: opponentTeamName, color: opponentTeamColor, internalName: 'íŒ€ B' };
        tossOutcomeText = `ì•ë©´! ${ourTeamName}ì´ ì„ ê³µì…ë‹ˆë‹¤!`;
      } else { 
        teamAMappedInfo = { name: opponentTeamName, color: opponentTeamColor, internalName: 'íŒ€ A' };
        teamBMappedInfo = { name: ourTeamName, color: ourTeamColor, internalName: 'íŒ€ B' };
        tossOutcomeText = `ë’·ë©´! ${opponentTeamName}ì´ ì„ ê³µì…ë‹ˆë‹¤!`;
      }
      
      tossResultElement.textContent = tossOutcomeText;
      coinElement.textContent = isHeads ? "ì•ë©´" : "ë’·ë©´";

      setTimeout(() => {
        coinTossScreen.style.display = 'none'; 
        banpickScreen.style.display = 'block'; 

        // ë°´í”½ ì‹œì‘! (ê³ ì •ë§µ í¬í•¨)
        pickedMaps = [FIXED_MAP]; 
        currentBannedMaps = [];
        currentPhaseIndex = 0; 

        currentTurnInternal = 'íŒ€ A'; 
        currentPhase = phasePlan[0].type; 
        
        ourTeamNameDisplay.textContent = ourTeamName;
        opponentTeamNameDisplay.textContent = opponentTeamName;

        mapSearchInput.value = ''; 
        mapSearchInput.disabled = false; 
        
        updateOverallUI(); 
        startTimer();
      }, 2000); 
    }, 1000); 
  }

  startButton.addEventListener('click', () => {
    ourTeamName = ourTeamNameInput.value.trim() || "Blue Team";
    opponentTeamName = opponentTeamNameInput.value.trim() || "Red Team";

    startScreen.style.display = 'none'; 
    coinTossScreen.style.display = 'flex'; 
    coinElement.textContent = "?"; 
    tossResultElement.textContent = "ë™ì „ì„ í´ë¦­í•´ì£¼ì„¸ìš”!"; 
  });

  coinElement.addEventListener('click', handleCoinToss); 

  document.addEventListener('DOMContentLoaded', () => {
    startScreen.style.display = 'block'; 
    coinTossScreen.style.display = 'none'; 
    banpickScreen.style.display = 'none';
    rouletteModal.style.display = 'none'; 
  });
</script>
</body>

</html>

